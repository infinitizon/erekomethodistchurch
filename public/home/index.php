<?php/* * Include necessary files */include_once 'core/init.inc.php';$fxns = new Functions($dbo);/* * Set up the page title and CSS files */$page_title = ":: Home &rsaquo;&rsaquo; Ereko Methodist Church ::";$common_css_files = array('jquery-ui-11/jquery-ui.min.css', 'common.css', 'uploadify/uploadify.css');$page_css_files = array('main.css');$font_awesome_files = array('font-awesome.css');$general_js_files = array('jquery-1-11.min.js', 'jquery-ui-11/jquery-ui.min.js'    , 'ckeditor/ckeditor.js', 'validationEngine/jquery.validationEngine-en.js'    , 'validationEngine/jquery.validationEngine.js', 'ckeditor/jquery.js'    , 'validator.js', 'uploadify/jquery.uploadify.js', 'common.js');$page_js_files = array('main.js');$ie_js_files = array();#####  Check if submit button was clickedif (isset($_POST) && @$_POST['submit'] == 'Submit') {    $sqlGetMe = "SELECT * FROM t_wb_pro_usr WHERE r_k={$_SESSION['r_k']}";    $sqlGetMe = $fxns->_execQuery($sqlGetMe, TRUE, FALSE);    //Try to reset password if there are any changes    $err_msg = NULL;    $success_msg = NULL;    if (!empty($_POST['old_pass']) || !empty($_POST['new_pass']) || !empty($_POST['new_pass_again'])) {        $curr_pass = trim($_POST['old_pass']);        $new_pass = trim($_POST['new_pass']);        $new_pass_again = trim($_POST['new_pass_again']);        if ($new_pass != $new_pass_again || $new_pass == '' || $new_pass_again == '') {            $err_msg = "The new passwords entered do not match!";        } else {            if (sha1($salt . md5($curr_pass . $salt)) === $sqlGetMe['usr_pass']) { //Check if a record is found.                try {                    /// Update the password in the db                    $stmt_updt_pass = "UPDATE t_wb_pro_usr SET usr_pass=:pass WHERE r_k=:r_k";                    $stmt_updt_pass = $dbo->prepare($stmt_updt_pass);                    $stmt_updt_pass->execute(array(':pass' => sha1($salt . md5($new_pass . $salt)), ':r_k' => $_SESSION['r_k']));                    $success_msg .= "Password updated successfully!";                } catch (exception $e) {                    $err_msg = "Error: " . $e->getMessage();                }            } else {                $err_msg .= " The current password entered is incorrect.<br />Please try again later";            }        }    }//# :End password Change    $diff = 0;    $updCol = NULL;    unset($_POST['submit']);    unset($_POST['old_pass']);    unset($_POST['new_pass']);    unset($_POST['new_pass_again']);    foreach ($_POST as $key => $val) {        if ($_POST[$key] != $sqlGetMe[$key]) {            $diff += 1;            $updCol .= "$key = '" . $_POST[$key] . "', ";        }    }    if ($diff > 0) {        $updCol = substr($updCol, 0, strrpos($updCol, ","));        $sqlUpdMe = "UPDATE t_wb_pro_usr SET " . $updCol . " WHERE r_k =" . $_SESSION['r_k'];        $result = $fxns->_execQuery($sqlUpdMe, FALSE, FALSE);        if ($result == 1) {            $success_msg .= " Profile updated successfully<br />"; //.@$createLnk;        } elseif ($result['result'] == 'Failure') {            $err_msg .= "<blockquote>" . $result['msg'] . "</blockquote>";        }    } else {        $err_msg .= "No changes made!";    }    $message = isset($success_msg) ? $success_msg : $err_msg;    $type = isset($success_msg) ? 'success' : 'err';}/* * Include the header */include_once 'assets/common/header.inc.php';?><div id="content">    <p>    <h2>Welcome to the Admin Dashboard</h1>        <h2 class="icon-user" style="font-style: italic;"> Profile</h2>        </p><?php$sqlGetMe = "SELECT * FROM t_wb_pro_usr WHERE r_k={$_SESSION['r_k']}";$sqlGetMe = $fxns->_execQuery($sqlGetMe, TRUE, FALSE);?>        <form action="" method="POST">            <table cellpadding="5">                <tr><td>&nbsp;</td><td class="align_noreq"><input type="submit" class="button" name="submit" value="Submit" /></td></tr>                <tr><td>Username</td><td><input type="text" disabled="disabled" value="<?php echo $sqlGetMe['usr_nm'] ?>" />Usernames cannot be changed</td></tr>                <tr><td>Firstname</td><td><input type="text" name="fst_nm" value="<?php echo $sqlGetMe['fst_nm'] ?>" /></td></tr>                <tr><td>Middlename</td><td><input type="text" name="mdl_nm" value="<?php echo $sqlGetMe['mdl_nm'] ?>" /></td></tr>                <tr><td>Lastname</td><td><input type="text" name="lst_nm" value="<?php echo $sqlGetMe['lst_nm'] ?>" /></td></tr>                <tr><td>Phone Number</td><td><input type="text" name="phn_no" value="<?php echo $sqlGetMe['phn_no'] ?>" /></td></tr>                <tr><td>Email Address</td><td><input type="text" name="eml_adr" value="<?php echo $sqlGetMe['eml_adr'] ?>" /></td></tr>                <tr><td>Address Line 1</td><td><textarea name="pry_adr_ln1" ><?php echo $sqlGetMe['pry_adr_ln1'] ?></textarea></td></tr>                <tr><td>Address Line 2</td><td><textarea name="pry_adr_ln2" ><?php echo $sqlGetMe['pry_adr_ln2'] ?></textarea></td></tr><?php$sql_getCountry = "SELECT val_id, val_dsc FROM t_wb_lov                                WHERE def_id='CTC-CTR'";echo "<tr><td>Country</td><td>" . $fxns->_getLOVs($sql_getCountry, "val_id", "val_dsc", 'pry_adr_ctr', '', "--Select Country--", @$sqlGetMe['pry_adr_ctr']) . "</td><tr>";$sql_getState = "SELECT val_id, val_dsc FROM t_wb_lov                            WHERE def_id='CTC-STA'";echo "<tr><td>State</td><td>" . $fxns->_getLOVs($sql_getState, "val_id", "val_dsc", 'pry_adr_sta', '', "--Select State--", @$sqlGetMe['pry_adr_sta']) . "</td><tr>";?>                <tr><td>City</td><td><input type="text" name="pry_adr_cty" value="<?php echo $sqlGetMe['pry_adr_cty'] ?>" /></td></tr>                <tr><td valign="top" >Change Password</td>                    <td>                        <span class="err">You don't need to enter a password unless it is neccessary</span><br/>                        <input type="password" name="old_pass" placeholder="Old Password" /><br />                        <input type="password" name="new_pass" placeholder="New Password" /><br />                        <input type="password" name="new_pass_again" placeholder="New Password Again" />                    </td></tr>            </table>                </form></div><?phpinclude_once 'assets/common/footer.inc.php';